# Document Template Customizer (DTC)

This tool allows you to produce *personalized document templates* from a larger base template repository, such as https://github.com/bflorat/architecture-document-template[this one].

While I‚Äôve received good feedback on my previous document templates, a recurring criticism was that the *templates were too large*, leaving many sections unused. With DTC, you can *prepare smaller, tailored templates* filtered from a larger one.

DTC can work not only with my own templates, but also with any base document template (self-hosted or not), as long as it follows a small metamodel.

## Common use-case

. An expert (typically an *Enterprise Architect*) selects or writes a base template. This base template is usually organization-wide.
. Another expert (typically a *Solution Architect*) creates a customized, curated template for one or several projects. This includes both a *full template with explanations* and *blank documents* to be filled.
. The project team then fills the *blank documents*, guided by the explanations in the customized template.

## Prerequisites for a Base Template

* The template must be written in **AsciiDoc (Asciidoctor flavor)** ‚Äî with sections starting with `#` characters, not `=` ‚Äî or in **Markdown**.
* A **`README.adoc`** or **`README.md`** file must be present at the root of the base template URL, providing an introduction.

[TIP]  
We strongly recommend using **AsciiDoc** rather than Markdown for important documents, as it provides richer features such as admonitions, better tables, and an automatic table of contents.

* A **`base-template-metadata.yaml`** file must be present at the root of the base template URL. A sample is provided below.

.Sample `base-template-metadata.yaml` :

```
author: ACME
license: CC BY-SA 4.0
parts:
  - name: Application
    file: view-application.adoc
  - name: Development
    file: view-development.adoc
  - name: infrastructure
    file: view-infrastructure.adoc  
labels:
  - detail_level: 
      - abstract      # conceptual, principles, big picture
      - overview      # broad but slightly more concrete
      - detailed      # technical specifics, diagrams, modules
      - in-depth      # exhaustive detail, e.g., data models, algorithms
  - name: persistence
  - name: green-IT
```

* Every section of each part file of the base template should be annotated with a metadata line just above the section title. Supported syntaxes:
  ** AsciiDoc comment: `//üè∑{"id": "74c82505-5f47-4342-8f1b-f6951d603062", "labels": ["level::basic", "project_size::*", "detail_level::abstract","context"]}`
  ** Markdown HTML comment: `<!--üè∑{"id": "74c82505-5f47-4342-8f1b-f6951d603062", "labels": ["level::basic", "project_size::*", "detail_level::abstract","context"]}-->`
  ** First level section (with a single `#`) is always kept and should not be annotated.
  ** Used labels must be listed in the `base-template-metadata.yaml` file to be token into account.
  ** Labels can be simple flag (like `performance`)
  ** Some others are multi-values (like: `project_size` that supports three values in this example: `project_size::large`, `project_size::medium` and `project_size::small`). All available values must be listed in `base-template-metadata.yaml` file.
  ** You can use the `*` wildcard  in the multi-values labels. It means _any_. For instance, if you want that a section is always kept, whatever the project size is, set a `project_size::*` label on it.
  ** Find many examples in https://github.com/bflorat/architecture-document-template[this base template].


## Matching rules

- If all or none label is selected, resulting template = the full base template.
- The first level sections (single '#') are always kept.
- The labels act as a 'AND' logical operator : a section is kept only if all associated labels are selected.
- If a parent section doesn't match, all sub-sections are dropped recursively.
- If a parent section matches, each sub-section is evaluated and only matching sections are kept.
- If the base template is annotated with a wilcard multi-value label like `project_size::*` , any selected label (like `project_size::small` or `project_size::large` matches.

## CLI usage

Build the CLI once, then generate a filtered archive:

```
npm run cli -- --base-url https://raw.githubusercontent.com/bflorat/architecture-document-template/refs/heads/feat/add-medadata  --include level::basic,persistence 
```

Options:

* `--base-url` (`-b`) ‚Äì required. The template root exposing `base-template-metadata.yaml`.
* `--include` (`-i`) ‚Äì comma-separated labels to keep (matching sections stay, others are pruned). Unknown labels abort the run.
* `--output` (`-o`) ‚Äì optional zip destination relative to the current directory (defaults to `custom-template.zip`).
* `--output-file` ‚Äì optional absolute or relative output path.

The generated archive contains two folders:

* `template/` keeps the filtered parts with their metadata marker lines intact.
* `blank-template/` contains the same parts reduced to section titles and AsciiDoc attributes (body text removed).

If none `--include` labels are provided, the resulting template contains every base template sections. The base template **must** expose a `README.adoc` (case-insensitive) alongside `base-template-metadata.yaml`.


## Tips
* Produced template contains it the zip a `customization-context.yaml` file containing every information used to create it : date of the template generation, base template url, selected labels.



